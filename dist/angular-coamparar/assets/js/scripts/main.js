var twiliochat=function(){var GENERAL_CHANNEL_UNIQUE_NAME,GENERAL_CHANNEL_NAME,tc={};tc.broker_company="";var $channelList,$inputText,$usernameInput,$statusRow,$connectPanel,$newChannelInputRow,$newChannelInput,$typingRow,$user_information;function handleUsernameInputKeypress(event){13===event.keyCode&&connectClientWithUsername()}function handleInputTextKeypress(event){if(13===event.keyCode){if(""==$(this).text())return void $($(this).blur());tc.currentChannel.sendMessage($(this).text(),$user_information.lead_details),event.preventDefault(),$(this).html("")}else notifyTyping()}tc.username="",$(document).ready(function(){tc.init()}),tc.init=function(){tc.$messageList=$("#message-list"),$channelList=$("#channel-list"),$inputText=$("#input-text"),$usernameInput=$("#username-input"),$statusRow=$("#status-row"),$connectPanel=$("#connect-panel"),$newChannelInputRow=$("#new-channel-input-row"),$newChannelInput=$("#new-channel-input"),$typingRow=$("#typing-row"),$("#typing-placeholder"),$usernameInput.focus(),$usernameInput.on("keypress",handleUsernameInputKeypress),$newChannelInput.on("keypress",tc.handleNewChannelInputKeypress),$("#connect-image").on("click",connectClientWithUsername),$("#add-channel-image").on("click",showAddChannelInput),$("#leave-span").on("click",disconnectClient),$("#delete-channel-span").on("click",deleteCurrentChannel)},tc.initializeTwilioChatProcess=function(user_information){$username=tc.username,GENERAL_CHANNEL_UNIQUE_NAME=user_information.channelName,GENERAL_CHANNEL_NAME=user_information.channelName,($inputText=$(".text-box")).on("keypress",handleInputTextKeypress),$user_information=user_information,connectClientWithUsername()},tc.send_message_onClick=function(event){""!=$(".text-box").text()&&(tc.currentChannel.sendMessage($(".text-box").text(),$user_information.lead_details),$(".text-box").html("")),$("#sendMessage").blur()};var notifyTyping=$.throttle(function(){tc.currentChannel.typing()},1e3);function connectClientWithUsername(){fetchAccessToken(tc.username,connectMessagingClient)}function fetchAccessToken(username,handler){$.post("//vemmrealtime.herokuapp.com/token",{identity:username,device:"browser"},null,"json").done(function(response){handler(response.token)}).fail(function(error){console.log("Failed to fetch the Access Token with error: "+error)})}function connectMessagingClient(token){tc.messagingClient=new Twilio.Chat.Client(token),tc.messagingClient.initialize().then(function(){tc.messagingClient.getChannelByUniqueName(GENERAL_CHANNEL_UNIQUE_NAME).then(function(channel){tc.generalChannel=channel,setupChannel(tc.generalChannel)}).catch(function(){tc.createPrivateChannel()}),tc.messagingClient.on("tokenExpired",refreshToken)})}function refreshToken(){fetchAccessToken(tc.username,setNewToken)}function setNewToken(token){tc.messagingClient.updateToken(tokenResponse.token)}function joinChannel(_channel){return _channel.join().then(function(joinedChannel){return function(selectedChannel){var channelElement=$(".channel-element").toArray().filter(function(element){return $(element).data().sid===selectedChannel.sid});channelElement=$(channelElement),void 0===tc.currentChannelContainer&&selectedChannel.uniqueName===GENERAL_CHANNEL_UNIQUE_NAME&&(tc.currentChannelContainer=channelElement);tc.currentChannelContainer.removeClass("selected-channel").addClass("unselected-channel"),channelElement.removeClass("unselected-channel").addClass("selected-channel"),tc.currentChannelContainer=channelElement}(_channel),tc.currentChannel=_channel,tc.loadMessages(),joinedChannel})}function initChannelEvents(){tc.currentChannel.on("messageAdded",tc.addMessageToList),tc.currentChannel.on("typingStarted",showTypingStarted),tc.currentChannel.on("typingEnded",hideTypingStarted)}function setupChannel(channel){return leaveCurrentChannel().then(function(){return function(channel){return tc.messagingClient.getChannelBySid(channel.sid)}(channel)}).then(function(_channel){return joinChannel(_channel)}).then(initChannelEvents)}function leaveCurrentChannel(){return tc.currentChannel?tc.currentChannel.leave().then(function(leftChannel){leftChannel.removeListener("messageAdded",tc.addMessageToList),leftChannel.removeListener("typingStarted",showTypingStarted),leftChannel.removeListener("typingEnded",hideTypingStarted),leftChannel.removeListener("memberJoined",notifyMemberJoined),leftChannel.removeListener("memberLeft",notifyMemberLeft)}):Promise.resolve()}function notifyMemberJoined(member){notify(member.identity+" joined the channel")}function notifyMemberLeft(member){notify(member.identity+" left the channel")}function notify(message){var row=$("<div>").addClass("col-md-12");row.loadTemplate("#member-notification-template",{status:message}),tc.$messageList.append(row),tc.$messageList.scrollTop(tc.$messageList[0].scrollHeight)}function showTypingStarted(member){$("#user-typing").show()}function hideTypingStarted(member){$("#user-typing").hide()}function showAddChannelInput(){tc.messagingClient&&($newChannelInputRow.addClass("showing").removeClass("not-showing"),$channelList.addClass("showing").removeClass("not-showing"),$newChannelInput.focus())}function hideAddChannelInput(){$newChannelInputRow.addClass("not-showing").removeClass("showing"),$channelList.addClass("not-showing").removeClass("showing"),$newChannelInput.val("")}function addChannel(channel){channel.uniqueName===GENERAL_CHANNEL_UNIQUE_NAME&&(tc.generalChannel=channel)}function deleteCurrentChannel(){tc.currentChannel&&(tc.currentChannel.sid!==tc.generalChannel.sid?tc.currentChannel.delete().then(function(channel){setupChannel(tc.generalChannel)}):alert("You cannot delete the general channel"))}function disconnectClient(){leaveCurrentChannel(),$channelList.text(""),tc.$messageList.text(""),channels=void 0,$statusRow.addClass("disconnected").removeClass("connected"),tc.$messageList.addClass("disconnected").removeClass("connected"),$connectPanel.addClass("disconnected").removeClass("connected"),$inputText.removeClass("with-shadow"),$typingRow.addClass("disconnected").removeClass("connected")}return tc.handleNewChannelInputKeypress=function(event){13===event.keyCode&&(tc.messagingClient.createChannel({friendlyName:$newChannelInput.val()}).then(hideAddChannelInput),$(this).val(""),event.preventDefault())},tc.loadChannelList=function(handler){void 0!==tc.messagingClient&&tc.messagingClient.getPublicChannels().then(function(channels){tc.channelArray=tc.sortChannelsByName(channels.items),$channelList.text(""),tc.channelArray.forEach(addChannel),"function"==typeof handler&&handler()})},tc.createPrivateChannel=function(){tc.messagingClient.createChannel({uniqueName:GENERAL_CHANNEL_UNIQUE_NAME,friendlyName:GENERAL_CHANNEL_NAME,attributes:$user_information.lead_details}).then(function(channel){tc.generalChannel=channel,setupChannel(tc.generalChannel)})},tc.joinGeneralChannel=function(){tc.generalChannel?setupChannel(tc.generalChannel):tc.messagingClient.createChannel({uniqueName:GENERAL_CHANNEL_UNIQUE_NAME,friendlyName:GENERAL_CHANNEL_NAME}).then(function(channel){tc.generalChannel=channel,tc.loadChannelList(tc.joinGeneralChannel)})},tc.loadMessages=function(){tc.currentChannel.getMessages(50).then(function(messages){messages.items.forEach(tc.addMessageToList)})},tc.addMessageToList=function(message){var user,timestamp=dateFormatter.getTodayDate(message.timestamp);user=tc.username==message.author?"self":window.$vemmChat.isConnectedWithBroker?"broker":"other","{red}"==(message=message.body).substring(0,5)?(message=message.substring(5),$(".messages").append($('<li class="other"><font color=red><b>'+message+'</b></font><br><span class="msg-timestamp">'+timestamp+"</span></li>"))):$(".messages").append($('<li class="'+user+'">'+message+'<br><span class="msg-timestamp">'+timestamp+"</span></li>")),$(".messages").animate({scrollTop:$(".messages")[0].scrollHeight},100)},tc.deleteCurrentChannel=function(){tc.currentChannel&&tc.currentChannel.delete().then(function(channel){})},tc.sortChannelsByName=function(channels){return channels.sort(function(a,b){return a.friendlyName===GENERAL_CHANNEL_NAME?-1:b.friendlyName===GENERAL_CHANNEL_NAME?1:a.friendlyName.localeCompare(b.friendlyName)})},tc}(),dateFormatter=function(){var df={getTodayDate:function(date){var outputDate,today=moment(),inputDate=moment(date);return outputDate=today.format("YYYYMMDD")==inputDate.format("YYYYMMDD")?"Today - ":inputDate.format("MMM. D - "),outputDate+=inputDate.format("hh:mma")}};return df}();function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}!function($){var Animation,Growl;$.fn.barfiller=function(options){var resizeTimeout,transitionPrefix,defaults=$.extend({barColor:"#0d6129",tooltip:!1,duration:1e3,animateOnResize:!0,symbol:"%"},options),object=$(this),settings=$.extend(defaults,options),barWidth=object.width(),fill=object.find(".fill"),toolTip=object.find(".tip"),fillPercentage=fill.attr("data-percentage"),transitionSupport=!1,methods={init:function(){return this.each(function(){methods.getTransitionSupport()&&(transitionSupport=!0,transitionPrefix=methods.getTransitionPrefix()),methods.appendHTML(),methods.setEventHandlers(),methods.initializeItems()})},appendHTML:function(){fill.css("background",settings.barColor),settings.tooltip||toolTip.css("display","none"),toolTip.text(fillPercentage+settings.symbol)},setEventHandlers:function(){settings.animateOnResize&&$(window).on("resize",function(event){clearTimeout(resizeTimeout),resizeTimeout=setTimeout(function(){methods.refill()},300)})},initializeItems:function(){var pctWidth=methods.calculateFill(fillPercentage);object.find(".tipWrap").css({display:"inline"}),transitionSupport?methods.transitionFill(pctWidth):methods.animateFill(pctWidth)},getTransitionSupport:function(){var thisStyle=(document.body||document.documentElement).style;return void 0!==thisStyle.transition||void 0!==thisStyle.WebkitTransition||void 0!==thisStyle.MozTransition||void 0!==thisStyle.MsTransition||void 0!==thisStyle.OTransition},getTransitionPrefix:function(){return/mozilla/.test(navigator.userAgent.toLowerCase())&&!/webkit/.test(navigator.userAgent.toLowerCase())?"-moz-transition":/webkit/.test(navigator.userAgent.toLowerCase())?"-webkit-transition":/opera/.test(navigator.userAgent.toLowerCase())?"-o-transition":/msie/.test(navigator.userAgent.toLowerCase())?"-ms-transition":"transition"},getTransition:function(val,time,type){var CSSObj;return"width"===type?CSSObj={width:val}:"left"===type&&(CSSObj={left:val}),time/=1e3,CSSObj[transitionPrefix]=type+" "+time+"s ease-in-out",CSSObj},refill:function(){fill.css("width",0),toolTip.css("left",0),barWidth=object.width(),methods.initializeItems()},calculateFill:function(percentage){return barWidth*(percentage*=.01)},transitionFill:function(barWidth){var toolTipOffset=barWidth-toolTip.width();fill.css(methods.getTransition(barWidth,settings.duration,"width")),toolTip.css(methods.getTransition(toolTipOffset,settings.duration,"left"))},animateFill:function(barWidth){var toolTipOffset=barWidth-toolTip.width();fill.stop().animate({width:"+="+barWidth},settings.duration),toolTip.stop().animate({left:"+="+toolTipOffset},settings.duration)}};return methods[options]?methods[options].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==_typeof(options)&&options?void $.error('Method "'+method+'" does not exist in barfiller plugin!'):methods.init.apply(this)},$=jQuery,Animation=function(){var Animation=function(){function Animation(){_classCallCheck(this,Animation)}return _createClass(Animation,null,[{key:"transition",value:function($el){var el,ref,result,type;for(type in el=$el[0],ref=this.transitions)if(result=ref[type],null!=el.style[type])return result}}]),Animation}();return Animation.transitions={webkitTransition:"webkitTransitionEnd",mozTransition:"mozTransitionEnd",oTransition:"oTransitionEnd",transition:"transitionend"},Animation}(),Growl=function(){var Growl=function(){function Growl(){var settings=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,Growl),this.render=this.render.bind(this),this.bind=this.bind.bind(this),this.unbind=this.unbind.bind(this),this.mouseEnter=this.mouseEnter.bind(this),this.mouseLeave=this.mouseLeave.bind(this),this.click=this.click.bind(this),this.close=this.close.bind(this),this.cycle=this.cycle.bind(this),this.waitAndDismiss=this.waitAndDismiss.bind(this),this.present=this.present.bind(this),this.dismiss=this.dismiss.bind(this),this.remove=this.remove.bind(this),this.animate=this.animate.bind(this),this.$growls=this.$growls.bind(this),this.$growl=this.$growl.bind(this),this.html=this.html.bind(this),this.content=this.content.bind(this),this.container=this.container.bind(this),this.settings=$.extend({},Growl.settings,settings),this.initialize(this.settings.location),this.render()}return _createClass(Growl,null,[{key:"growl",value:function(){return new Growl(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}}]),_createClass(Growl,[{key:"initialize",value:function(location){var id;return $("body:not(:has(#"+(id="growls-"+location)+"))").append('<div id="'+id+'" />')}},{key:"render",value:function(){var $growl;$growl=this.$growl(),this.$growls(this.settings.location).append($growl),this.settings.fixed?this.present():this.cycle()}},{key:"bind",value:function(){var $growl=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.$growl();return $growl.on("click",this.click),this.settings.delayOnHover&&($growl.on("mouseenter",this.mouseEnter),$growl.on("mouseleave",this.mouseLeave)),$growl.on("contextmenu",this.close).find("."+this.settings.namespace+"-close").on("click",this.close)}},{key:"unbind",value:function(){var $growl=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.$growl();return $growl.off("click",this.click),this.settings.delayOnHover&&($growl.off("mouseenter",this.mouseEnter),$growl.off("mouseleave",this.mouseLeave)),$growl.off("contextmenu",this.close).find("."+this.settings.namespace+"-close").off("click",this.close)}},{key:"mouseEnter",value:function(event){return this.$growl().stop(!0,!0)}},{key:"mouseLeave",value:function(event){return this.waitAndDismiss()}},{key:"click",value:function(event){if(null!=this.settings.url)return event.preventDefault(),event.stopPropagation(),window.open(this.settings.url)}},{key:"close",value:function(event){return event.preventDefault(),event.stopPropagation(),this.$growl().stop().queue(this.dismiss).queue(this.remove)}},{key:"cycle",value:function(){return this.$growl().queue(this.present).queue(this.waitAndDismiss())}},{key:"waitAndDismiss",value:function(){return this.$growl().delay(this.settings.duration).queue(this.dismiss).queue(this.remove)}},{key:"present",value:function(callback){var $growl;return $growl=this.$growl(),this.bind($growl),this.animate($growl,this.settings.namespace+"-incoming","out",callback)}},{key:"dismiss",value:function(callback){var $growl;return $growl=this.$growl(),this.unbind($growl),this.animate($growl,this.settings.namespace+"-outgoing","in",callback)}},{key:"remove",value:function(callback){return this.$growl().remove(),"function"==typeof callback?callback():void 0}},{key:"animate",value:function($element,name){var transition,direction=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"in",callback=arguments[3];transition=Animation.transition($element),$element["in"===direction?"removeClass":"addClass"](name),$element.offset().position,$element["in"===direction?"addClass":"removeClass"](name),null!=callback&&(null!=transition?$element.one(transition,callback):callback())}},{key:"$growls",value:function(location){var base;return null==this.$_growls&&(this.$_growls=[]),null!=(base=this.$_growls)[location]?base[location]:base[location]=$("#growls-"+location)}},{key:"$growl",value:function(){return null!=this.$_growl?this.$_growl:this.$_growl=$(this.html())}},{key:"html",value:function(){return this.container(this.content())}},{key:"content",value:function(){return"<div class='"+this.settings.namespace+"-close'>"+this.settings.close+"</div>\n<div class='"+this.settings.namespace+"-title'>"+this.settings.title+"</div>\n<div class='"+this.settings.namespace+"-message'>"+this.settings.message+"</div>"}},{key:"container",value:function(content){return"<div class='"+this.settings.namespace+" "+this.settings.namespace+"-"+this.settings.style+" "+this.settings.namespace+"-"+this.settings.size+"'>\n  "+content+"\n</div>"}}]),Growl}();return Growl.settings={namespace:"growl",duration:3200,close:"&#215;",location:"default",style:"default",size:"medium",delayOnHover:!0},Growl}(),this.Growl=Growl,$.growl=function(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return Growl.growl(options)},$.growl.error=function(){var settings,options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return settings={title:"Error!",style:"error"},$.growl($.extend(settings,options))},$.growl.notice=function(){var settings,options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return settings={title:"Notice!",style:"notice"},$.growl($.extend(settings,options))},$.growl.warning=function(){var settings,options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return settings={title:"Warning!",style:"warning"},$.growl($.extend(settings,options))}}(jQuery);var element=$(".floating-chat");function openElement(){var messages=element.find(".messages"),textInput=element.find(".text-box");element.find(">img").hide(),element.addClass("expand"),element.find(".chat").addClass("enter"),element.find(".header").css("display","flex");textInput.val().length;element.off("click",openElement),element.find(".header button").click(closeElement),messages.scrollTop(messages.prop("scrollHeight"))}function closeElement(){element.find(".chat").removeClass("enter").hide(),element.find(">img").show(),element.removeClass("expand"),element.find(".header button").off("click",closeElement),element.find(".header").hide(),setTimeout(function(){element.find(".chat").removeClass("enter").show(),element.click(openElement)},500)}setTimeout(function(){element.addClass("enter")},1e3),element.click(openElement);try{var chat=document.getElementsByClassName("floating-chat")[0],customHeaderHTML=chat.getElementsByClassName("custom-header")[0].outerHTML;chat.innerHTML='\n    <img src="style/images/chat/buttom.gif" height="60px" width="60px" class="chat-logo">\n    '.concat(customHeaderHTML||"",'\n    <div class="header">\n        <div>\n            <div class="chat-header">\n                <div style="padding: 10px;">\n                    <div class="broker-avatar"></div>\n                </div>\n                <div style="padding: 10px;width: 100%;flex-grow: 1;">\n                    <li class="brokerStatus">Já estamos procurando um profissional para atender você!</li>\n                    <li class="brokerName-title"></li>\n                    <li class="broker-company"></li>\n                    <li id="user-typing">Typing..</li>\n                </div>\n                <div>\n                    <div class="company-opener hidden" onclick="openCompanyHeader()">\n                        <img class="icon icon--small" src="style/images/sprite.svg#chat--chevron-down">\n                        <span>saiba mais</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div>\n            <ul class="company-header">\n                <li class="company-avatar"></li>\n                <li class="company-phone--wrapper">\n                    <img src="style/images/sprite.svg#chat--phone">\n                    <span class="company-phone"></span>\n                </li>\n                <li class="company-url--wrapper">\n                    <img src="style/images/sprite.svg#chat--internet">\n                    <span class="company-url"></span>\n                </li>\n                <li class="company-susep--wrapper">\n                    <span style="padding-right: 5px;">SUSEP:</span>\n                    <span class="company-susep"></span>\n                </li>\n            </ul>\n            <div class="company-closer hidden"  onclick="closeCompanyHeader()">\n                <img class="icon icon--small" src="style/images/sprite.svg#chat--chevron-down">\n            </div>\n        </div>\n    </div>\n    <div class="chat">\n        <ul class="messages"></ul>\n        <div class="chat__thank-you hidden">\n            <img class="chat__thank-you__icon icon icon--small" src="style/images/sprite.svg#chat--thank-you">\n            <p class="chat__thank-you__title">Obrigado!</p>\n            <p class="chat__thank-you__text">A sua opinião é muito importante para nós.</p>\n        </div>\n        <div class="footer">\n            <div class="text-box" placeholder="digite aqui.." contenteditable="true" disabled="true"></div>\n            <button id="sendMessage" onclick="twiliochat.send_message_onClick(event);">\n                <img class="icon" src="style/images/sprite.svg#chat--send-message">\n            </button>\n        </div>\n    </div>\n')}catch(error){console.log("no chat")}function openCompanyHeader(){$(".company-header")[0].classList.add("expanded"),$(".company-opener")[0].classList.add("hidden"),$(".company-closer")[0].classList.remove("hidden")}function closeCompanyHeader(){$(".company-header")[0].classList.remove("expanded"),$(".company-opener")[0].classList.remove("hidden"),$(".company-closer")[0].classList.add("hidden")}window.$vemmChat={isConnectedWithBroker:!1},window.progress_bar_cb=function(data){if(console.log("progress_bar_cb:",data),data.new_form_payload){var broker_avatar=data.new_form_payload.agent_photo,broker_name=data.new_form_payload.agent_name,broker_company=data.new_form_payload.agent_company;document.documentElement.style.setProperty("--avatar-broker",'url("'+broker_avatar+'")'),$(".brokerName-title").text(broker_name),$(".broker-company").text(broker_company),$(".brokerStatus").text("Estamos te conectando com:")}else console.log("progress_bar_cb: requirements not met")},window.broker_found_cb=function(data){console.log("broker_found_cb:",data),data.new_form_payload||console.log("broker_found_cb: requirements not met");var broker_avatar=data.new_form_payload.agent_photo;document.documentElement.style.setProperty("--avatar-broker",'url("'+broker_avatar+'")'),fetch(data.new_form_payload.agent_company_url).then(function(response){return response.json()}).then(function(response){var phone=data.new_form_payload.agent_phone,avatar=response.company.logo,site=response.company.site,susep=response.company.susep;(phone?$(".company-phone").text(phone):$(".company-phone--wrapper").hide(),site?$(".company-url").text(site):$(".company-url--wrapper").hide(),susep?$(".company-susep").text(susep):$(".company-susep--wrapper").hide(),(phone||site||susep)&&$(".company-opener")[0].classList.remove("hidden"),avatar)&&($(".company-header")[0].classList.add("company-header--with-avatar"),document.documentElement.style.setProperty("--avatar-company",'url("'+avatar+'")'))}),$(".brokerStatus").text("Você está conversando com:"),window.$vemmChat.isConnectedWithBroker=!0,$(".floating-chat")[0].setAttribute("status","connected"),$(".messages").append($('\n      <div class="separator chat-started">\n          <span>'.concat(data.payload.broker," da ").concat(data.payload.company," está conversando com você</span>\n      </div>"))),$(".messages").animate({scrollTop:$(".messages")[0].scrollHeight},"slow")},window.user_rating_cb=function(data){$(".floating-chat")[0].setAttribute("status","disconnected"),$(".messages").animate({scrollTop:$(".messages")[0].scrollHeight},"slow"),window.$vemmChat.isConnectedWithBroker=!1};var $consumer_session_id,$vemmsessionID,$userSubmittedRatings=0,$isRatingSubmitted=!(window.submit_chat_ratings_cd=function(){$(".messages").addClass("hidden"),$(".chat__thank-you").removeClass("hidden")});function initiateVemmSessionID(){return window.vemm.clickerData?window.vemm.clickerData.vemmSessionId?void startListeningPusherMessages(window.vemm.clickerData.vemmSessionId):(console.log("sessionID is not defined"),void setTimeout(function(){initiateVemmSessionID()},1e3)):(console.log("window.vemm.clickerData is not defined"),void setTimeout(function(){initiateVemmSessionID()},1e3))}function startListeningPusherMessages(vemmSessionId){var channel=new Pusher("1892c28570d0d1d9a96c").subscribe("consumer-forms-on-speed-"+vemmSessionId);function mark_previous_progress_bar_as_complete(){0<$(".event_progress").length&&$(".event_progress ").each(function(){$(this).find(".fill").attr("data-percentage",100);var id=$(this).attr("id");$("#"+id).barfiller()})}channel.bind("notification",function(data){var compactVesion=data.compactVersion,messageType=data.messageType,textMessage=data.message;0==$("#realTimeNotification").length||compactVesion?$.growl.notice({title:messageType,message:textMessage,fixed:!0}):($(".thank-you-content").hide(),$(".notification").append($('<p style="line-height: normal">'+textMessage+"</p>")),$(".notification").show())}),channel.bind("spinner",function(data){var divId=data.message.payload.id,htmlText=data.message.payload.html,progressBarPercentage=data.message.payload.progress,compactVesion=data.message.payload.compactVersion,messageType=data.message.messageType;if(0==$("#realTimeNotification").length||compactVesion)$.growl.notice({title:messageType,message:'<div id="'+divId+'" ><label >'+htmlText+'&nbsp;&nbsp;<img src="/style/images/check.png" width="15" height="15"></img></label></div>',fixed:!0});else{if($(".thank-you-content").hide(),0<$("#"+divId).length&&100==progressBarPercentage)return $("#"+divId).remove(),void $(".spinner").append($('<div id="'+divId+'" ><label >'+htmlText+'&nbsp;&nbsp;<img src="/style/images/check.png" width="15" height="15"></img></label></div>'));$(".spinner").append($('<div id="'+divId+'" ><label class="spinner-align-center">'+htmlText+'&nbsp;&nbsp;<img src="/style/images/chat/spinner.gif" class="spinner-align-center" width="30" height="30"></img></label></div>')),$(".spinner").show()}}),channel.bind("progress_bar",function(data){$(".thank-you-content").hide();var divId=data.id,htmlText=data.message,progressBarPercentage=data.progress;0<$("#"+divId).length?$("#fill"+divId).attr("data-percentage",progressBarPercentage):(mark_previous_progress_bar_as_complete(),$("#fill"+divId).attr("data-percentage",progressBarPercentage),$(".progressBar").append($("<div id="+divId+' class="event_progress"><div ><label>'+htmlText+'</label></div><div class="barfiller"><div class="tipWrap"><span class="tip"></span></div><span class="fill" id="fill'+divId+'"data-percentage="'+progressBarPercentage+'"></span></div></div>')),$(".progressBar").show()),$("#"+divId).barfiller(),window.progress_bar_cb&&window.progress_bar_cb(data)}),channel.bind("open_chat",function(data){setRequiredPropertiesToinitializeChat(data)}),channel.bind("secondary_chats",function(data){setRequiredPropertiesToinitializeChat(data)}),channel.bind("broker_found",function(data){openElement(),mark_previous_progress_bar_as_complete();var broker=data.payload.broker,broker_company=data.payload.company;data.request_type;$consumer_session_id=data.consumer_session_id,$vemmsessionID=data.vemm_session_id;var message=data.message;if($(".notification").hide(),$(".progressBar").hide(),$(".spinner").hide(),$(".broker-found").append($('<div class="obrigado"><p>'+message+"</p></div>")),Cookies.get("chatDetails")){var chatDetails=reCreateCookiesOfChatDetails();chatDetails.broker_name=broker,chatDetails.broker_company=broker_company,Cookies.set("chatDetails",chatDetails,{expires:1})}else Cookies.set("chatDetails",{broker_name:broker,broker_company:broker_company},{expires:1});$(".brokerName-title").text(broker),$(".broker-company").text(broker_company),$(".broker-company").show(),window.$vemmChat.isConnectedWithBroker,window.broker_found_cb&&window.broker_found_cb(data)}),channel.bind("user_rating",function(data){var request_type=data.request_type;$consumer_session_id=data.consumer_session_id,$vemmsessionID=data.vemm_session_id,"chats"==request_type?checkAndSubmitRatings():$(".user-ratings").append($('<div class="obrigado"><div id="reviewStars-input" style="display: inline-block;" title="call"><p style="line-height: normal">Como foi sua experiência?</p><br><input id="star-4" type="radio" name="reviewStars"/><label title="5" for="star-4"></label><input id="star-3" type="radio" name="reviewStars"/><label title="4" for="star-3"></label><input id="star-2" type="radio" name="reviewStars"/><label title="3" for="star-2"></label><input id="star-1" type="radio" name="reviewStars"/><label title="2" for="star-1"></label><input id="star-0" type="radio" name="reviewStars"/><label title="1" for="star-0"></label></div><div id="thankyou-call" style="display:none"><p style="line-height: normal">Obrigado !!</p></div></div>')),$("#reviewStars-input label").click(submit_chat_ratings),window.user_rating_cb&&window.user_rating_cb(data)}),channel.bind("broker_not_found",function(data){data.request_type;$consumer_session_id=data.consumer_session_id,$vemmsessionID=data.vemm_session_id;var message=data.message;$(".thank-you-content").hide(),$(".notification").empty(),$(".progressBar").empty(),$(".spinner").empty(),$(".notification").append($('<p style="line-height: normal">'+message+"</p>"))})}function setRequiredPropertiesToinitializeChat(data){var consumer_details={},channelName="consumer-forms-on-speed-"+data.vemm_session_id;consumer_details.channelName=channelName,consumer_details.lead_details=data.payload.lead_details,consumer_details.lead_details.created_by=consumer_details.lead_details.created_by||"consumer",twiliochat.username=data.payload.lead_details.name,Cookies.set("chatDetails",{channelName:consumer_details.channelName,chatuser:twiliochat.username,lead_details:consumer_details.lead_details},{expires:1}),twiliochat.initializeTwilioChatProcess(consumer_details),$(".title").text("Please wait.."),$(".floating-chat").show(),$(".floating-chat").trigger("click"),$("body").addClass("vemm-chat-mode--expanded")}function reCreateCookiesOfChatDetails(){var chatDetails=JSON.parse(Cookies.get("chatDetails"));return Cookies.remove("chatDetails"),chatDetails}function checkAndSubmitRatings(){if(!$isRatingSubmitted){$isRatingSubmitted=!0;var chatDetails=reCreateCookiesOfChatDetails();chatDetails.isRatingSubmitted=$isRatingSubmitted,Cookies.set("chatDetails",chatDetails,{expires:1}),openRatingWindow()}}function openRatingWindow(){$(".messages").append($('<div class="separator chat-ended"><span>Chat encerrado</span></div>')),$(".messages").append($('<div><div id="reviewStars-input" title="chats"><p style="font-weight: bold">Como foi o seu atendimento?</p><div class="stars"><input id="star-4" type="radio" name="reviewStars" /><label title="5" for="star-4"></label><input id="star-3" type="radio" name="reviewStars" /><label title="4" for="star-3"></label><input id="star-2" type="radio" name="reviewStars" /><label title="3" for="star-2"></label><input id="star-1" type="radio" name="reviewStars" /><label title="2" for="star-1"></label><input id="star-0" type="radio" name="reviewStars" /><label title="1" for="star-0"></label></div></div><div id="thankyou-chat" style="display: none"><p style="font-weight: bold">Obrigado !!</p></div></div>')),$("#reviewStars-input label").click(submit_chat_ratings)}function submit_chat_ratings(method){event.preventDefault();var request_type=event.target.parentElement.title,consumer_rated=event.target.title;$.post("//vemmcalls.herokuapp.com/consumer_sessions/"+$consumer_session_id+"/consumer_rating?vemm_session_id="+$vemmsessionID+"&consumer_rating="+consumer_rated).done(function(response){}).fail(function(error){}),"chats"==request_type?$("#thankyou-chat").show():$("#thankyou-call").show(),$(this).parent().hide(),window.submit_chat_ratings_cd&&window.submit_chat_ratings_cd()}setTimeout(function(){initiateVemmSessionID()},1e3),$(window).load(function(){if(Cookies.get("chatDetails")){var chatDetails=JSON.parse(Cookies.get("chatDetails"));if(chatDetails.channelName){var consumer_details={};consumer_details.channelName=chatDetails.channelName,consumer_details.lead_details=chatDetails.lead_details,twiliochat.username=chatDetails.chatuser,$isRatingSubmitted=chatDetails.isRatingSubmitted,twiliochat.initializeTwilioChatProcess(consumer_details),$(".title").text("Please wait.."),$(".floating-chat").show(),$(".floating-chat").trigger("click"),$("body").addClass("vemm-chat-mode--expanded"),$(".title").text(chatDetails.broker_name),$(".broker-company").text(chatDetails.broker_company),$(".broker-company").show()}}});